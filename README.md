# MeshGame — プロジェクト概要

## MeshGame とは？

MeshGame は、検証可能（Verifiable）、分散型（Distributed）、かつ確定的（Deterministic）なゲームエンジンです。

以下の機能を提供します：

- 汎用的な状態ベースのゲームエンジン
- 分散型通信レイヤー
- 検証可能な実行の基盤（将来的な ZK 統合を見据えた設計）

MeshGame はゲームを以下のように定義します：

> 各参加者によって独立して実行される、
> 「確定的状態遷移システム」である。

すべてのノードが同じエンジンを実行し、共有された状態遷移からコンセンサスが生まれます。

## コア・フィロソフィー（設計思想）

MeshGame は 4 つの原則に基づいて構築されています：

### 1. 状態マシンとしてのゲーム

描画（レンダリング）や UI の前提はありません。純粋で確定的なロジックのみを扱います。

### 2. 確定的実行 (Deterministic Execution)

入力が与えられたとき：

```
(state, action, meta)
```

すべてのノードは必ず以下の結果を生成します：

```
same next state (同一の次の状態)
```

これにより以下が可能になります：

- リプレイ性 (Replayability)
- 監査可能性 (Auditability)
- 検証可能性 (Verification)

注意：ゲームエンジン自体はティック（Tick）ベースでは動作しません。状態遷移はアクションとそれに関連付けられたメタデータ（順序情報等）に基づいて発生します。

### 3. 分散型設計 (Distributed by Design)

MeshGame は以下のサポートを念頭に構築されています：

- P2P 通信
- Lockstep Ordering 等の分散型コンセンサスモデル

中央サーバーの存在を前提としません。

### 4. 検証可能な基盤 (Verifiable Foundations)

将来的な拡張として以下を含みます：

- アクションのコミットメント
- 状態ハッシュ
- ゼロ知識証明（ZK）によるバリデーション
- 不正証明 (Fraud Proofs)
- 確定的リプレイ証明

MeshGame は、トラストレスなマルチプレイヤーシステムの基盤となることを目指しています。

# アーキテクチャ概要

現在の実装（`packages/core/src`）の構成：

```
packages/core/src/
 ├─ engine/      # 確定的ゲームエンジン（State, Rule, System）
 ├─ net/         # P2P / ネットワーク輸送抽象化（WebRTC, Signaling）
 ├─ ordering/    # コンセンサスモデル（Lockstep Ordering 等）
 ├─ protocol/    # 通信プロトコル・コーデック
 ├─ security/    # 認証・署名レイヤー（Identity, Signed Transport）
 ├─ sync/        # 状態同期・スナップショット
 └─ time/        # 論理時計・順序管理用のティック管理
```

# ロードマップ

## フェーズ 1 — 確定的コア (MVP)

- [x] 状態の抽象化 (`engine/`)
- [x] ルール定義 API (`engine/rule.ts`)
- [x] システム (state → state) (`engine/system.ts`)
- [x] リプレイ可能な実行
- [x] アクションログ (`log/`)

目標：

> 完全に確定的でリプレイ可能なゲームランタイムの実現。

## フェーズ 2 — 分散レイヤー

- [x] 輸送層の抽象化 (`net/transport.ts`)
- [x] P2P 通信インターフェース (WebRTC Mesh)
- [x] Lockstep Ordering による同期
- [ ] 競合検知 (Conflict detection)
- [ ] 状態リコンシリエーション (State reconciliation)

目標：

> 中央サーバーなしでの複数ノード間同期実行の実現。

## フェーズ 3 — 検証レイヤー

- [ ] 状態ハッシュ化
- [ ] アクション・コミットメント・スキーム
- [ ] 不正検知フック
- [ ] 確定的なリプレイ証明
- [ ] ZK 回路統合の研究

目標：

> 検証可能な分散型ゲーム実行の実現。

## フェーズ 4 — 高度な分散モデル

- [ ] 部分的メッシュトポロジー
- [ ] 適応型配布プロトコル
- [ ] ビザンチン障害耐性 (BFT) の実験
- [ ] トラスト最小化コンセンサスモジュール

## フェーズ 5 — 形式化

- [ ] 数理モデルのドキュメント化
- [ ] 形式的な状態遷移仕様
- [ ] 確定的な証明の保証
- [ ] 学術論文ドラフト

# ターゲット・ユースケース

- ターン制マルチプレイヤーゲーム
- Lockstep 方式の戦略ゲーム（RTS 等）
- 完全な P2P ボードゲーム
- 検証可能な対戦システム
- 分散型確定的システムの研究

# 長期ビジョン

MeshGame が目指す姿：

> 分散型かつ検証可能なシステムのための、
> 汎用的な確定的ゲームランタイム。

単なるゲームエンジンではなく、トラストレスなインタラクティブ計算の基盤。
